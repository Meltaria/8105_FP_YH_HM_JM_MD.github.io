<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Linear Regression</title>

<script src="site_libs/header-attrs-2.18/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="data_cleaning.html">Data Cleaning</a>
</li>
<li>
  <a href="linear-regression.html">Data Analysis</a>
</li>
<li>
  <a href="index.html">Project Report</a>
</li>
<li>
  <a href="https://jsm2182.shinyapps.io/exploredatashiny/">Explore our Data</a>
</li>
<li>
  <a href="https://github.com/Meltaria/8105_FP_YH_HM_JM_MD.github.io">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Linear Regression</h1>

</div>


<div id="exploratory-analysis" class="section level2">
<h2>Exploratory Analysis</h2>
<pre class="r"><code>summary(nhanes)</code></pre>
<pre><code>##     agecrude       age_decile        age_quartile     gender    
##  Min.   :20.00   60-69  :1258   &lt;25 years  : 393   Female:3288  
##  1st Qu.:38.00   50-59  :1094   25-49 years:2334   Male  :3010  
##  Median :54.00   40-49  : 969   50-74 years:2813                
##  Mean   :52.25   30-39  : 940   â‰¥75 years  : 758                
##  3rd Qu.:66.00   20-29  : 818                                   
##  Max.   :80.00   70-79  : 725                                   
##                  (Other): 494                                   
##                  race                 poverty                 educat    
##  Mexican American  : 616   Index of 0-4.99:5404   &lt;9th grade     : 404  
##  Other Hispanic    : 550   Index &gt;=5      : 894   High school/GED:2209  
##  Non-Hispanic White:2424                          College        :2095  
##  Non-Hispanic Black:1710                          College Grad+  :1590  
##  Non-Hispanic Asian: 699                                                
##  Other/Multi-Racial: 299                                                
##                                                                         
##  insany                            hepb                             hepc     
##  No : 900   No History of Hepatitis B:6226   No History of Hepatitis C:6174  
##  Yes:5398   History of Hepatitis B   :  72   History of Hepatitis C   : 124  
##                                                                              
##                                                                              
##                                                                              
##                                                                              
##                                                                              
##                   hepbvax    
##  At Least Three Doses :1911  
##  Less Than Three Doses: 260  
##  No Doses             :4127  
##                              
##                              
##                              
## </code></pre>
<pre class="r"><code>pair_plots = nhanes %&gt;%
  relocate(hepbvax) %&gt;%
  ggpairs()
pair_plots</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.</code></pre>
<p><img src="linear-regression_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>According to the plots, we may found most of the variable
distributions are normal, it would not be necessary to make some
transformation.</p>
<p>As we have three age variables in the data set and for each analysis,
we may need only one of them. Thus we may separate the data set into
dataset with age_decile, age_quartile and age_crude.</p>
<pre class="r"><code>nhanes_decile = nhanes %&gt;% 
  select( -age_quartile, -agecrude)

nhanes_quartile = nhanes %&gt;%
  select( -age_decile, -agecrude)

nhanes_crude = nhanes %&gt;%
  select( -age_decile, -age_quartile)</code></pre>
<p>Here, letâ€™s build two logistic regression models based on the NHANES
data set with different age variables.</p>
<pre class="r"><code>fit1 = glm(hepbvax ~ ., data = nhanes_decile, family = binomial())
summary(fit1)</code></pre>
<pre><code>## 
## Call:
## glm(formula = hepbvax ~ ., family = binomial(), data = nhanes_decile)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.7533  -0.8049   0.4724   0.7591   2.0611  
## 
## Coefficients:
##                            Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                 0.39298    0.20880   1.882 0.059825 .  
## age_decile30-39             0.93727    0.10558   8.878  &lt; 2e-16 ***
## age_decile40-49             1.68453    0.10833  15.550  &lt; 2e-16 ***
## age_decile50-59             2.25859    0.11201  20.164  &lt; 2e-16 ***
## age_decile60-69             2.55615    0.11425  22.373  &lt; 2e-16 ***
## age_decile70-79             3.05573    0.14613  20.911  &lt; 2e-16 ***
## age_decile80+               3.86756    0.22177  17.439  &lt; 2e-16 ***
## genderMale                  0.54083    0.06368   8.493  &lt; 2e-16 ***
## raceOther Hispanic         -0.44413    0.14841  -2.993 0.002766 ** 
## raceNon-Hispanic White     -0.32159    0.12038  -2.671 0.007552 ** 
## raceNon-Hispanic Black     -0.11850    0.12254  -0.967 0.333524    
## raceNon-Hispanic Asian     -0.52172    0.14097  -3.701 0.000215 ***
## raceOther/Multi-Racial     -0.30932    0.17447  -1.773 0.076235 .  
## povertyIndex &gt;=5           -0.13252    0.09197  -1.441 0.149605    
## educatHigh school/GED      -0.41600    0.18029  -2.307 0.021034 *  
## educatCollege              -1.08172    0.17931  -6.033 1.61e-09 ***
## educatCollege Grad+        -1.24229    0.18391  -6.755 1.43e-11 ***
## insanyYes                  -0.49316    0.09334  -5.283 1.27e-07 ***
## hepbHistory of Hepatitis B -0.11781    0.29478  -0.400 0.689417    
## hepcHistory of Hepatitis C -0.31016    0.23671  -1.310 0.190105    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 7730.7  on 6297  degrees of freedom
## Residual deviance: 6210.1  on 6278  degrees of freedom
## AIC: 6250.1
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>fit2 = glm(hepbvax ~ ., data = nhanes_quartile, family = binomial())
summary(fit2)</code></pre>
<pre><code>## 
## Call:
## glm(formula = hepbvax ~ ., family = binomial(), data = nhanes_quartile)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.6867  -0.9309   0.4872   0.7890   2.0756  
## 
## Coefficients:
##                            Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                 0.15915    0.22422   0.710  0.47782    
## age_quartile25-49 years     1.26053    0.12505  10.080  &lt; 2e-16 ***
## age_quartile50-74 years     2.61594    0.12914  20.257  &lt; 2e-16 ***
## age_quartileâ‰¥75 years       3.77683    0.19238  19.633  &lt; 2e-16 ***
## genderMale                  0.55765    0.06256   8.913  &lt; 2e-16 ***
## raceOther Hispanic         -0.38615    0.14602  -2.645  0.00818 ** 
## raceNon-Hispanic White     -0.25047    0.11806  -2.122  0.03387 *  
## raceNon-Hispanic Black     -0.09437    0.12029  -0.784  0.43276    
## raceNon-Hispanic Asian     -0.50983    0.13839  -3.684  0.00023 ***
## raceOther/Multi-Racial     -0.28614    0.17043  -1.679  0.09316 .  
## povertyIndex &gt;=5           -0.10093    0.09088  -1.110  0.26679    
## educatHigh school/GED      -0.52099    0.17845  -2.920  0.00351 ** 
## educatCollege              -1.16901    0.17773  -6.577 4.79e-11 ***
## educatCollege Grad+        -1.32578    0.18230  -7.272 3.53e-13 ***
## insanyYes                  -0.35418    0.09069  -3.905 9.41e-05 ***
## hepbHistory of Hepatitis B  0.02221    0.29644   0.075  0.94026    
## hepcHistory of Hepatitis C -0.25937    0.23406  -1.108  0.26780    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 7730.7  on 6297  degrees of freedom
## Residual deviance: 6379.2  on 6281  degrees of freedom
## AIC: 6413.2
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>fit3 = glm(hepbvax ~ ., data = nhanes_crude, family = binomial())
summary(fit3)</code></pre>
<pre><code>## 
## Call:
## glm(formula = hepbvax ~ ., family = binomial(), data = nhanes_crude)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.7084  -0.8430   0.4533   0.7678   1.9438  
## 
## Coefficients:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                -0.938004   0.213178  -4.400 1.08e-05 ***
## agecrude                    0.063338   0.002097  30.198  &lt; 2e-16 ***
## genderMale                  0.543245   0.063558   8.547  &lt; 2e-16 ***
## raceOther Hispanic         -0.437334   0.147478  -2.965 0.003023 ** 
## raceNon-Hispanic White     -0.340403   0.119122  -2.858 0.004269 ** 
## raceNon-Hispanic Black     -0.122445   0.121365  -1.009 0.313024    
## raceNon-Hispanic Asian     -0.489023   0.139734  -3.500 0.000466 ***
## raceOther/Multi-Racial     -0.294390   0.172910  -1.703 0.088650 .  
## povertyIndex &gt;=5           -0.104682   0.092304  -1.134 0.256752    
## educatHigh school/GED      -0.430501   0.179782  -2.395 0.016640 *  
## educatCollege              -1.077829   0.179058  -6.019 1.75e-09 ***
## educatCollege Grad+        -1.245563   0.183914  -6.773 1.27e-11 ***
## insanyYes                  -0.487101   0.091650  -5.315 1.07e-07 ***
## hepbHistory of Hepatitis B -0.135657   0.299006  -0.454 0.650050    
## hepcHistory of Hepatitis C -0.337341   0.236944  -1.424 0.154529    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 7730.7  on 6297  degrees of freedom
## Residual deviance: 6204.2  on 6283  degrees of freedom
## AIC: 6234.2
## 
## Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div id="automatic-selection" class="section level2">
<h2>Automatic Selection</h2>
<p>Here we would like to do automatic selection to choose the best
subsets for our models.</p>
<div id="model-with-age_decile" class="section level3">
<h3>Model with age_decile</h3>
<p><strong>Backward Selection</strong></p>
<pre class="r"><code>step(fit1, direction = &quot;backward&quot;)</code></pre>
<pre><code>## Start:  AIC=6250.1
## hepbvax ~ age_decile + gender + race + poverty + educat + insany + 
##     hepb + hepc
## 
##              Df Deviance    AIC
## - hepb        1   6210.3 6248.3
## - hepc        1   6211.7 6249.7
## &lt;none&gt;            6210.1 6250.1
## - poverty     1   6212.2 6250.2
## - race        5   6233.9 6263.9
## - insany      1   6239.0 6277.0
## - gender      1   6283.3 6321.3
## - educat      3   6346.3 6380.3
## - age_decile  6   7333.1 7361.1
## 
## Step:  AIC=6248.26
## hepbvax ~ age_decile + gender + race + poverty + educat + insany + 
##     hepc
## 
##              Df Deviance    AIC
## - hepc        1   6212.0 6248.0
## &lt;none&gt;            6210.3 6248.3
## - poverty     1   6212.3 6248.3
## - race        5   6234.3 6262.3
## - insany      1   6239.1 6275.1
## - gender      1   6283.3 6319.3
## - educat      3   6346.4 6378.4
## - age_decile  6   7333.4 7359.4
## 
## Step:  AIC=6247.96
## hepbvax ~ age_decile + gender + race + poverty + educat + insany
## 
##              Df Deviance    AIC
## - poverty     1   6213.9 6247.9
## &lt;none&gt;            6212.0 6248.0
## - race        5   6235.8 6261.8
## - insany      1   6240.7 6274.7
## - gender      1   6284.2 6318.2
## - educat      3   6347.1 6377.1
## - age_decile  6   7334.3 7358.3
## 
## Step:  AIC=6247.94
## hepbvax ~ age_decile + gender + race + educat + insany
## 
##              Df Deviance    AIC
## &lt;none&gt;            6213.9 6247.9
## - race        5   6239.0 6263.0
## - insany      1   6244.1 6276.1
## - gender      1   6285.2 6317.2
## - educat      3   6365.0 6393.0
## - age_decile  6   7334.3 7356.3</code></pre>
<pre><code>## 
## Call:  glm(formula = hepbvax ~ age_decile + gender + race + educat + 
##     insany, family = binomial(), data = nhanes_decile)
## 
## Coefficients:
##            (Intercept)         age_decile30-39         age_decile40-49  
##                 0.4078                  0.9299                  1.6728  
##        age_decile50-59         age_decile60-69         age_decile70-79  
##                 2.2364                  2.5332                  3.0449  
##          age_decile80+              genderMale      raceOther Hispanic  
##                 3.8650                  0.5324                 -0.4387  
## raceNon-Hispanic White  raceNon-Hispanic Black  raceNon-Hispanic Asian  
##                -0.3274                 -0.1124                 -0.5297  
## raceOther/Multi-Racial   educatHigh school/GED           educatCollege  
##                -0.3061                 -0.4248                 -1.0941  
##    educatCollege Grad+               insanyYes  
##                -1.2790                 -0.5024  
## 
## Degrees of Freedom: 6297 Total (i.e. Null);  6281 Residual
## Null Deviance:       7731 
## Residual Deviance: 6214  AIC: 6248</code></pre>
<p>The model we obtained is <strong>glm(formula = hepbvax ~ age_decile +
gender + race + educat + insany, family = binomial(), data =
nhanes_decile)</strong></p>
<p><strong>Forward Selection</strong></p>
<pre class="r"><code>step(fit1, direction = &quot;forward&quot;)</code></pre>
<pre><code>## Start:  AIC=6250.1
## hepbvax ~ age_decile + gender + race + poverty + educat + insany + 
##     hepb + hepc</code></pre>
<pre><code>## 
## Call:  glm(formula = hepbvax ~ age_decile + gender + race + poverty + 
##     educat + insany + hepb + hepc, family = binomial(), data = nhanes_decile)
## 
## Coefficients:
##                (Intercept)             age_decile30-39  
##                     0.3930                      0.9373  
##            age_decile40-49             age_decile50-59  
##                     1.6845                      2.2586  
##            age_decile60-69             age_decile70-79  
##                     2.5562                      3.0557  
##              age_decile80+                  genderMale  
##                     3.8676                      0.5408  
##         raceOther Hispanic      raceNon-Hispanic White  
##                    -0.4441                     -0.3216  
##     raceNon-Hispanic Black      raceNon-Hispanic Asian  
##                    -0.1185                     -0.5217  
##     raceOther/Multi-Racial            povertyIndex &gt;=5  
##                    -0.3093                     -0.1325  
##      educatHigh school/GED               educatCollege  
##                    -0.4160                     -1.0817  
##        educatCollege Grad+                   insanyYes  
##                    -1.2423                     -0.4932  
## hepbHistory of Hepatitis B  hepcHistory of Hepatitis C  
##                    -0.1178                     -0.3102  
## 
## Degrees of Freedom: 6297 Total (i.e. Null);  6278 Residual
## Null Deviance:       7731 
## Residual Deviance: 6210  AIC: 6250</code></pre>
<p>The model we obtained is <strong>glm(formula = hepbvax ~ age_decile +
gender + race + poverty + educat + insany + hepb + hepc, family =
binomial(), data = nhanes_decile)</strong></p>
</div>
<div id="model-with-age_quartile" class="section level3">
<h3>Model with age_quartile</h3>
<p><strong>Backward Selection</strong></p>
<pre class="r"><code>step(fit2, direction = &quot;backward&quot;)</code></pre>
<pre><code>## Start:  AIC=6413.24
## hepbvax ~ age_quartile + gender + race + poverty + educat + insany + 
##     hepb + hepc
## 
##                Df Deviance    AIC
## - hepb          1   6379.2 6411.2
## - hepc          1   6380.4 6412.4
## - poverty       1   6380.5 6412.5
## &lt;none&gt;              6379.2 6413.2
## - race          5   6401.4 6425.4
## - insany        1   6394.8 6426.8
## - gender        1   6459.9 6491.9
## - educat        3   6521.0 6549.0
## - age_quartile  3   7333.1 7361.1
## 
## Step:  AIC=6411.25
## hepbvax ~ age_quartile + gender + race + poverty + educat + insany + 
##     hepc
## 
##                Df Deviance    AIC
## - hepc          1   6380.4 6410.4
## - poverty       1   6380.5 6410.5
## &lt;none&gt;              6379.2 6411.2
## - race          5   6401.5 6423.5
## - insany        1   6394.8 6424.8
## - gender        1   6460.0 6490.0
## - educat        3   6521.0 6547.0
## - age_quartile  3   7333.4 7359.4
## 
## Step:  AIC=6410.42
## hepbvax ~ age_quartile + gender + race + poverty + educat + insany
## 
##                Df Deviance    AIC
## - poverty       1   6381.6 6409.6
## &lt;none&gt;              6380.4 6410.4
## - race          5   6402.4 6422.4
## - insany        1   6396.0 6424.0
## - gender        1   6460.5 6488.5
## - educat        3   6521.4 6545.4
## - age_quartile  3   7334.3 7358.3
## 
## Step:  AIC=6409.6
## hepbvax ~ age_quartile + gender + race + educat + insany
## 
##                Df Deviance    AIC
## &lt;none&gt;              6381.6 6409.6
## - race          5   6404.6 6422.6
## - insany        1   6398.0 6424.0
## - gender        1   6461.0 6487.0
## - educat        3   6537.0 6559.0
## - age_quartile  3   7334.3 7356.3</code></pre>
<pre><code>## 
## Call:  glm(formula = hepbvax ~ age_quartile + gender + race + educat + 
##     insany, family = binomial(), data = nhanes_quartile)
## 
## Coefficients:
##             (Intercept)  age_quartile25-49 years  age_quartile50-74 years  
##                 0.17054                  1.25539                  2.60137  
##   age_quartileâ‰¥75 years               genderMale       raceOther Hispanic  
##                 3.77381                  0.55177                 -0.38263  
##  raceNon-Hispanic White   raceNon-Hispanic Black   raceNon-Hispanic Asian  
##                -0.25442                 -0.08995                 -0.51384  
##  raceOther/Multi-Racial    educatHigh school/GED            educatCollege  
##                -0.28324                 -0.52828                 -1.17913  
##     educatCollege Grad+                insanyYes  
##                -1.35420                 -0.36130  
## 
## Degrees of Freedom: 6297 Total (i.e. Null);  6284 Residual
## Null Deviance:       7731 
## Residual Deviance: 6382  AIC: 6410</code></pre>
<p>The model we obtained is <strong>glm(formula = hepbvax ~ age_quartile
+ gender + race + educat + insany, family = binomial(), data =
nhanes_quartile)</strong></p>
<p><strong>Forward Selection</strong></p>
<pre class="r"><code>step(fit2, direction = &quot;forward&quot;)</code></pre>
<pre><code>## Start:  AIC=6413.24
## hepbvax ~ age_quartile + gender + race + poverty + educat + insany + 
##     hepb + hepc</code></pre>
<pre><code>## 
## Call:  glm(formula = hepbvax ~ age_quartile + gender + race + poverty + 
##     educat + insany + hepb + hepc, family = binomial(), data = nhanes_quartile)
## 
## Coefficients:
##                (Intercept)     age_quartile25-49 years  
##                    0.15915                     1.26053  
##    age_quartile50-74 years       age_quartileâ‰¥75 years  
##                    2.61594                     3.77683  
##                 genderMale          raceOther Hispanic  
##                    0.55765                    -0.38615  
##     raceNon-Hispanic White      raceNon-Hispanic Black  
##                   -0.25047                    -0.09437  
##     raceNon-Hispanic Asian      raceOther/Multi-Racial  
##                   -0.50983                    -0.28614  
##           povertyIndex &gt;=5       educatHigh school/GED  
##                   -0.10093                    -0.52099  
##              educatCollege         educatCollege Grad+  
##                   -1.16901                    -1.32578  
##                  insanyYes  hepbHistory of Hepatitis B  
##                   -0.35418                     0.02221  
## hepcHistory of Hepatitis C  
##                   -0.25937  
## 
## Degrees of Freedom: 6297 Total (i.e. Null);  6281 Residual
## Null Deviance:       7731 
## Residual Deviance: 6379  AIC: 6413</code></pre>
<p>The model we obtained is <strong>glm(formula = hepbvax ~ age_quartile
+ gender + race + poverty + educat + insany + hepb + hepc, family =
binomial(), data = nhanes_quartile)</strong></p>
</div>
<div id="model-with-age_crude" class="section level3">
<h3>Model with age_crude</h3>
<p><strong>Backward Selection</strong></p>
<pre class="r"><code>step(fit3, direction = &quot;backward&quot;)</code></pre>
<pre><code>## Start:  AIC=6234.2
## hepbvax ~ agecrude + gender + race + poverty + educat + insany + 
##     hepb + hepc
## 
##            Df Deviance    AIC
## - hepb      1   6204.4 6232.4
## - poverty   1   6205.5 6233.5
## - hepc      1   6206.1 6234.1
## &lt;none&gt;          6204.2 6234.2
## - race      5   6226.7 6246.7
## - insany    1   6233.3 6261.3
## - gender    1   6278.3 6306.3
## - educat    3   6337.4 6361.4
## - agecrude  1   7333.1 7361.1
## 
## Step:  AIC=6232.4
## hepbvax ~ agecrude + gender + race + poverty + educat + insany + 
##     hepc
## 
##            Df Deviance    AIC
## - poverty   1   6205.7 6231.7
## &lt;none&gt;          6204.4 6232.4
## - hepc      1   6206.4 6232.4
## - race      5   6227.1 6245.1
## - insany    1   6233.5 6259.5
## - gender    1   6278.3 6304.3
## - educat    3   6337.6 6359.6
## - agecrude  1   7333.4 7359.4
## 
## Step:  AIC=6231.68
## hepbvax ~ agecrude + gender + race + educat + insany + hepc
## 
##            Df Deviance    AIC
## - hepc      1   6207.6 6231.6
## &lt;none&gt;          6205.7 6231.7
## - race      5   6229.4 6245.4
## - insany    1   6236.0 6260.0
## - gender    1   6278.9 6302.9
## - educat    3   6353.3 6373.3
## - agecrude  1   7333.5 7357.5
## 
## Step:  AIC=6231.63
## hepbvax ~ agecrude + gender + race + educat + insany
## 
##            Df Deviance    AIC
## &lt;none&gt;          6207.6 6231.6
## - race      5   6231.1 6245.1
## - insany    1   6237.8 6259.8
## - gender    1   6279.9 6301.9
## - educat    3   6353.9 6371.9
## - agecrude  1   7334.3 7356.3</code></pre>
<pre><code>## 
## Call:  glm(formula = hepbvax ~ agecrude + gender + race + educat + insany, 
##     family = binomial(), data = nhanes_crude)
## 
## Coefficients:
##            (Intercept)                agecrude              genderMale  
##               -0.92128                 0.06297                 0.53543  
##     raceOther Hispanic  raceNon-Hispanic White  raceNon-Hispanic Black  
##               -0.43324                -0.34469                -0.11847  
## raceNon-Hispanic Asian  raceOther/Multi-Racial   educatHigh school/GED  
##               -0.49636                -0.29225                -0.43683  
##          educatCollege     educatCollege Grad+               insanyYes  
##               -1.08667                -1.27232                -0.49408  
## 
## Degrees of Freedom: 6297 Total (i.e. Null);  6286 Residual
## Null Deviance:       7731 
## Residual Deviance: 6208  AIC: 6232</code></pre>
<p>The model we obtained is <strong>glm(formula = hepbvax ~ agecrude +
gender + race + educat + insany, family = binomial(), data =
nhanes_crude)</strong></p>
<p><strong>Forward Selection</strong></p>
<pre class="r"><code>step(fit3, direction = &quot;forward&quot;)</code></pre>
<pre><code>## Start:  AIC=6234.2
## hepbvax ~ agecrude + gender + race + poverty + educat + insany + 
##     hepb + hepc</code></pre>
<pre><code>## 
## Call:  glm(formula = hepbvax ~ agecrude + gender + race + poverty + 
##     educat + insany + hepb + hepc, family = binomial(), data = nhanes_crude)
## 
## Coefficients:
##                (Intercept)                    agecrude  
##                   -0.93800                     0.06334  
##                 genderMale          raceOther Hispanic  
##                    0.54324                    -0.43733  
##     raceNon-Hispanic White      raceNon-Hispanic Black  
##                   -0.34040                    -0.12244  
##     raceNon-Hispanic Asian      raceOther/Multi-Racial  
##                   -0.48902                    -0.29439  
##           povertyIndex &gt;=5       educatHigh school/GED  
##                   -0.10468                    -0.43050  
##              educatCollege         educatCollege Grad+  
##                   -1.07783                    -1.24556  
##                  insanyYes  hepbHistory of Hepatitis B  
##                   -0.48710                    -0.13566  
## hepcHistory of Hepatitis C  
##                   -0.33734  
## 
## Degrees of Freedom: 6297 Total (i.e. Null);  6283 Residual
## Null Deviance:       7731 
## Residual Deviance: 6204  AIC: 6234</code></pre>
<p>The model we obtained is <strong>glm(formula = hepbvax ~ agecrude +
gender + race + poverty + educat + insany + hepb + hepc, family =
binomial(), data = nhanes_crude)</strong></p>
<p>Comparing the AIC of the model with different variables, we can find
that the models with age_crude has the smallest AIC. Thus we will choose
age_crude as our age variable in the model.</p>
<p>The model obtained from Backward elimination and forward selection
were different. The Forward model three extra predictors included than
that of backward: poverty, hepb and hepc. To choose a better model,
further steps may be required.</p>
</div>
</div>
<div id="model-comparing" class="section level2">
<h2>Model Comparing</h2>
<p>Letâ€™s fit the models from backward elimination and forward
selection.</p>
<pre class="r"><code>fit_small = glm(formula = hepbvax ~ agecrude + gender + race + educat + insany, family = binomial(), data = nhanes_crude)
fit_large = glm(formula = hepbvax ~ agecrude + gender + race + poverty + educat + insany + hepb + hepc, family = binomial(), data = nhanes_crude)</code></pre>
<p>Anova would be used to make selection between the small model and the
large model.</p>
<pre class="r"><code>anova(fit_small, fit_large, test = &quot;LR&quot;)</code></pre>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: hepbvax ~ agecrude + gender + race + educat + insany
## Model 2: hepbvax ~ agecrude + gender + race + poverty + educat + insany + 
##     hepb + hepc
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1      6286     6207.6                     
## 2      6283     6204.2  3   3.4305   0.3299</code></pre>
<p>As the p value is 0.3299, larger than 0.05. Thus we can conclude that
the larger model is not superior. The model we would use would be the
smaller model with age_crude variable.</p>
<p>The model: <strong>fit_small = glm(formula = hepbvax ~ agecrude +
gender + race + educat + insany, family = binomial(), data =
nhanes_crude)</strong></p>
</div>
<div id="tidy-out" class="section level2">
<h2>Tidy out</h2>
<pre class="r"><code>model = fit_small

model %&gt;% 
  broom::glance()</code></pre>
<pre><code>## # A tibble: 1 Ã— 8
##   null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
##           &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
## 1         7731.    6297 -3104. 6232. 6313.    6208.        6286  6298</code></pre>
<pre class="r"><code>model %&gt;% 
  broom::tidy() %&gt;% 
  knitr::kable(digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-0.921</td>
<td align="right">0.213</td>
<td align="right">-4.328</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">agecrude</td>
<td align="right">0.063</td>
<td align="right">0.002</td>
<td align="right">30.244</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">genderMale</td>
<td align="right">0.535</td>
<td align="right">0.063</td>
<td align="right">8.447</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">raceOther Hispanic</td>
<td align="right">-0.433</td>
<td align="right">0.147</td>
<td align="right">-2.939</td>
<td align="right">0.003</td>
</tr>
<tr class="odd">
<td align="left">raceNon-Hispanic White</td>
<td align="right">-0.345</td>
<td align="right">0.119</td>
<td align="right">-2.895</td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">raceNon-Hispanic Black</td>
<td align="right">-0.118</td>
<td align="right">0.121</td>
<td align="right">-0.978</td>
<td align="right">0.328</td>
</tr>
<tr class="odd">
<td align="left">raceNon-Hispanic Asian</td>
<td align="right">-0.496</td>
<td align="right">0.139</td>
<td align="right">-3.560</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">raceOther/Multi-Racial</td>
<td align="right">-0.292</td>
<td align="right">0.173</td>
<td align="right">-1.691</td>
<td align="right">0.091</td>
</tr>
<tr class="odd">
<td align="left">educatHigh school/GED</td>
<td align="right">-0.437</td>
<td align="right">0.180</td>
<td align="right">-2.431</td>
<td align="right">0.015</td>
</tr>
<tr class="even">
<td align="left">educatCollege</td>
<td align="right">-1.087</td>
<td align="right">0.179</td>
<td align="right">-6.077</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">educatCollege Grad+</td>
<td align="right">-1.272</td>
<td align="right">0.182</td>
<td align="right">-7.008</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">insanyYes</td>
<td align="right">-0.494</td>
<td align="right">0.091</td>
<td align="right">-5.409</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>nhanes_pred = 
  nhanes_crude %&gt;% 
  modelr::add_predictions(model) %&gt;% 
  mutate(sample = as.numeric(hepbvax)) %&gt;%
  pivot_longer(pred:sample,
               names_to = &quot;name&quot;,
               values_to = &quot;value&quot;)

nhanes_pred %&gt;%
  ggplot(aes(x = value, color = name)) + 
  geom_histogram(position = &quot;dodge&quot;) + 
  labs(y = &quot;Frequency&quot;, x = &quot;Age in years&quot;, title = &quot;Hepbvax prediction (Logistic Regression)&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.</code></pre>
<p><img src="linear-regression_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>From this graph, we can see that the linear regression has poor
prediction power for our model. Therefore, we will introduce multinomial
logistic regression, and we will use the same predictors as we do in our
linear model.</p>
<pre class="r"><code>multi_nomial_reg = multinom(hepbvax ~ agecrude + gender + race + educat + insany, data = nhanes_crude)</code></pre>
<pre><code>## # weights:  39 (24 variable)
## initial  value 6919.060194 
## iter  10 value 4660.871677
## iter  20 value 4119.163521
## iter  30 value 4050.779971
## final  value 4050.640853 
## converged</code></pre>
<pre class="r"><code>summary(multi_nomial_reg)</code></pre>
<pre><code>## Call:
## multinom(formula = hepbvax ~ agecrude + gender + race + educat + 
##     insany, data = nhanes_crude)
## 
## Coefficients:
##                       (Intercept)   agecrude genderMale raceOther Hispanic
## Less Than Three Doses   -2.337593 0.03910372  0.2789295         -0.2307050
## No Doses                -1.097745 0.06491864  0.5574106         -0.4531124
##                       raceNon-Hispanic White raceNon-Hispanic Black
## Less Than Three Doses             -0.4285340             -0.5668854
## No Doses                          -0.3389911             -0.0859481
##                       raceNon-Hispanic Asian raceOther/Multi-Racial
## Less Than Three Doses            -0.08014559            -0.00735171
## No Doses                         -0.54763359            -0.32389037
##                       educatHigh school/GED educatCollege educatCollege Grad+
## Less Than Three Doses            -0.6452954     -1.141709           -1.107040
## No Doses                         -0.4218255     -1.083489           -1.289491
##                        insanyYes
## Less Than Three Doses -0.3768789
## No Doses              -0.5064467
## 
## Std. Errors:
##                       (Intercept)    agecrude genderMale raceOther Hispanic
## Less Than Three Doses   0.3812538 0.004301458 0.13512523          0.2863251
## No Doses                0.2151225 0.002117970 0.06424873          0.1493952
##                       raceNon-Hispanic White raceNon-Hispanic Black
## Less Than Three Doses              0.2416382              0.2571990
## No Doses                           0.1205930              0.1226403
##                       raceNon-Hispanic Asian raceOther/Multi-Racial
## Less Than Three Doses              0.2692767              0.3372540
## No Doses                           0.1418304              0.1758332
##                       educatHigh school/GED educatCollege educatCollege Grad+
## Less Than Three Doses             0.2947063     0.2981456           0.3017509
## No Doses                          0.1809713     0.1801754           0.1830176
##                        insanyYes
## Less Than Three Doses 0.19481673
## No Doses              0.09257146
## 
## Residual Deviance: 8101.282 
## AIC: 8149.282</code></pre>
<p>The model we obtained is <strong>multinom(formula = hepbvax ~
agecrude + gender + race + educat + insany, data =
nhanes_crude)</strong></p>
<pre class="r"><code>multi_pred = 
  nhanes_crude %&gt;% 
  modelr::add_predictions(multi_nomial_reg) %&gt;% 
  mutate(True_OR_False = ifelse(pred == hepbvax, TRUE, FALSE))

multi_pred %&gt;% 
  ggplot(aes(x = agecrude)) + 
  geom_histogram() + 
  facet_grid(. ~ True_OR_False) + 
  labs(y = &quot;Frequency&quot;, x=&quot;Age in years&quot;, title = &quot;True OR False v.s Age (Multinomial)&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.</code></pre>
<p><img src="linear-regression_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>We make a plot to show the prediction accuracy of our multinomial
logistic model with respect to age_crude. This graph brings us to
wonder: is there a tendency of prediction accuracy to vary with respect
to age_crude?</p>
<pre class="r"><code>cal_1 =  
  multi_pred %&gt;% 
  group_by(agecrude, True_OR_False) %&gt;% 
  summarize(count = n()) %&gt;% 
  filter(True_OR_False == TRUE) %&gt;% 
  select(-True_OR_False)</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;agecrude&#39;.
## You can override using the `.groups` argument.</code></pre>
<pre class="r"><code>cal_2 = multi_pred %&gt;% 
  group_by(agecrude) %&gt;% 
  summarize(count = n())

cal = left_join(cal_1,cal_2, by = &quot;agecrude&quot;) %&gt;% 
  mutate(accuracy = count.x/count.y)

cal %&gt;% 
  ggplot(aes(x = agecrude, y = accuracy)) +
  geom_smooth() + 
  labs(y = &quot;Accuracy&quot;, x = &quot;Age in years&quot;, title = &quot;Predict accuracy v.s Age (Multinomial)&quot;)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and
## formula = &#39;y ~ x&#39;</code></pre>
<p><img src="linear-regression_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>From this graph, we can see that, overall, our model has a predict
accuracy higher than 0.6, and for people older than 40, the accuracy
rises as the age increases.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
